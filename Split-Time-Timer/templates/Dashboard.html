<html lang="en" style="background-color: rgba(30,30,30,255);">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
        <title>Descenders Split Timer</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="icon" type="image/png" href="/static/Descenders Competitive.png">
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <meta name="Description" content="Just a guy and a computer. Take a look at some of my projects!">
        <img src="/static/Gifs/x_glitch.gif" style="display: none;">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    </head>
    <body style="padding:0; margin:0;" style="font-family: MontHeavy;">
        <div id="app">
            <v-app style="font-family: MontHeavy; background-color: rgba(30,30,30,255);">
                <v-main>
                    <v-banner color="warning">
                        <v-icon slot="icon" size="36" color="white">mdi-alert</v-icon>
                        This site is in construction - some features may be unavailable.
                    </v-banner>
                    <v-tabs style="height: 100%;">
                        <v-tab>Players</v-tab>
                        <v-tab>Trails</v-tab>
                        <v-tab>Controls</v-tab>
                        <v-tab>Config</v-tab>
                        <v-tab-item style="height: 100%;">
                            <br>
                            <v-list>
                                <v-autocomplete v-model="searched_name" :items="player_names" label="Search for player"></v-autocomplete>
                                <v-container v-for="player in players" v-if="(player.steam_name.indexOf(searched_name) != -1  || searched_name == '' || searched_name == null) && (player.is_competitor || !show_competitors_only) && (!show_online_only || player.online)">
                                    <v-card x-large color="blue">
                                        <v-card-title style="font-size: 40px; text-decoration: underline;">[[player.steam_name]]</v-card-title>
                                        <v-card-text style="font-size: 20px;">
                                            <br>
                                            <v-row v-if="debug">
                                                <v-col>Steam ID</v-col>
                                                <v-col>[[player.steam_id]]</v-col>
                                            </v-row>
                                            <v-row>
                                                <v-col>Current World</v-col>
                                                <v-col>[[player.current_world]]</v-col>
                                            </v-row>
                                            <v-row v-if="debug">
                                                <v-col>Trail Start Time</v-col>
                                                <v-col>[[player.trail_start_time]]</v-col>
                                            </v-row>
                                            <v-row v-if="debug">
                                                <v-col>Split Times</v-col>
                                                <v-col>[[player.split_times]]</v-col>
                                            </v-row>
                                            <v-row>
                                                <v-col>Current Trail</v-col>
                                                <v-col>[[player.current_trail]]</v-col>
                                            </v-row>
                                            <v-row>
                                                <v-col>Current Bike</v-col>
                                                <v-col>[[player.current_bike]]</v-col>
                                            </v-row>
                                            <v-row>
                                                <v-col>Total Time on [[player.current_world]]</v-col>
                                                <v-col>[[secondsToHms(player.total_time_on_world)]]</v-col>
                                            </v-row>
                                            <v-row>
                                                <v-col>Total time online</v-col>
                                                <v-col>[[secondsToHms(player.total_time)]]</v-col>
                                            </v-row>
                                        <v-card-actions>
                                            <v-badge offset-x="30" offset-y="20" overlap :color="player.colour">
                                                <v-avatar class="mr-3" size="80">
                                                    <v-img size="80" clas="elevation-6" :src="player.avatar_src">
                                                </v-avatar>
                                            </v-badge>
                                            <v-spacer></v-spacer>
                                            <v-checkbox v-model="player.is_competitor" @click="toggle_competitor(player.steam_id)" label="Competitor"></v-checkbox>
                                            <v-spacer></v-spacer>
                                            <v-select v-if="player.steam_id != '1234567890'" item-text="text" :items="ban_options" v-on:input="update_ban_status(player.steam_id, player.ban_state)" v-model="player.ban_state"></v-select>
                                            <v-spacer></v-spacer>
                                            <v-btn @click="monitor_player(player.steam_id)" :color="getColFromMonitoring(player.being_monitored)"/><v-icon>mdi-cctv</v-icon></v-btn>
                                        </v-card-actions>
                                    </v-card>
                                    <br><br>
                                </v-container>
                            </v-list>
                        </v-tab-item>
                        <v-tab-item style="height: 100%;">
                            <br><br><br>
                            <v-row no-gutters>
                                <v-col v-for="trail in trails" cols="12" sm="4">
                                    <v-card width="700" elevation="5">
                                        <v-img :src="trail.src"></v-img>
                                        <v-card-title>[[trail.trail_name]]</v-card-title>
                                        <v-card-text>
                                            Total Checkpoints: [[trail.total_checkpoints]]<br>
                                            Times Raced: [[trail.times_raced]]<br>
                                            World Name: [[trail.world_name]]
                                        </v-card-text>
                                        <v-sparkline
                                            :fill="fill"
                                            :gradient="selectedGradient"
                                            :line-width="width"
                                            :padding="padding"
                                            :smooth="radius "
                                            :value="trail.timestamps"
                                        >
                                        </v-sparkline>
                                    </v-card>
                                </v-col>
                            </v-row>
                            <br><br>
                        </v-tab-item>
                        <v-tab-item style="height: 100%;">
                            <v-btn style="width:300px; height:100px;" dense small onclick="$.get('/API/TOGGLE-RIDERS-GATE-START')">Riders Gate<v-icon>mdi-restart</v-icon></v-btn>
                        </v-tab-item>
                        <v-tab-item>
                            <v-col>
                                <v-checkbox dense onclick="$.get('/API/TOGGLE-FASTEST-SPLIT-TIMES')" label="Control split times for competitors."></v-checkbox>
                                <v-checkbox dense onclick="$.get('/API/TOGGLE-FASTEST-SPLIT-TIMES')" label="Control leaderboard for competitors."></v-checkbox>
                                <v-checkbox dense v-model="show_competitors_only" label="Show Competitors Only"></v-checkbox>
                                <v-checkbox dense v-model="show_online_only" label="Show Online Only"></v-checkbox>
                                <v-checkbox dense v-model="debug" label="Debug Mode"></v-checkbox>
                            </v-col>
                        </v-tab-item>
                    </v-tabs>
                </v-main>
            </v-app>
        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <style>
        @font-face {
            font-family: MontHeavy;
            src: url("/static/monofonto.otf");
        }
    </style>
    <script>        
        var app = new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            vuetify : new Vuetify({
                theme: {
                    dark : {
                        primary: '#00b140',
                        secondary: '#424242',
                        accent: '#82B1FF',
                        error: '#FF5252',
                        info: '#2196F3',
                        success: '#4CAF50',
                        warning: '#FFC107',
                    }
            },
            }),
            data : {

                fill: true,
                selectedGradient: ['#00c6ff', '#F0F', '#FF0'],
                padding: 8,
                radius: 10,
                value: [0, 2, 5, 9, 5, 10, 3, 5, 0, 0, 1, 8, 2, 9, 0],
                width: 2,

                searched_name : "",
                players: [],
                player_names: [],
                "competitor_only" : false,
                show_online_only : false,
                ban_options: ["unbanned", "shadowban", "destroy_player", "quit_game", "crash_game"],
                show_competitors_only : false,
                debug: false,
                trail_headers : [
                    {text:"trail_name", value:"trail_name"},
                    {text:"total_checkpoints", value: "total_checkpoints"},
                    {text:"times_raced", value: "times_raced"},
                    {text:"world_name", value: "world_name"},
                    {text:"downhill", value: "downhill"},
                    {text:"enduro", value: "enduro"},
                    {text:"hardtail", value: "hardtail"},
                ],
                trails : [
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                    {
                        "trail_name" : "Speed & Style",
                        "total_checkpoints" : "",
                        "times_raced" : "5",
                        "world_name" : "Snowbird Island",
                        "downhill" : true,
                        "enduro" : true,
                        "hardtail" : true,
                    },
                ],
            },
            methods: {
                update_players(){
                    console.log("Updating Players")
                    $.get("/API/DASHBOARD/GET-PLAYERS", function(data){
                        app.players = data["players"];
                    })
                },
                updatePlayerNames(){
                    app.player_names = []
                    for (let i = 0; i < app.players.length; i++){
                        steam_name = app.players[i].steam_name;
                        app.player_names.push(steam_name)
                    }
                },
                update_trails(){
                    console.log("Updating Players")
                    $.get("/API/DASHBOARD/TRAILS", function(data){
                        app.trails = data["data"];
                    })
                },
                getColFromMonitoring(being_monitored){
                    if (being_monitored){
                        return "green"
                    }
                    else{
                        return "black"
                    }
                },
                update_ban_status(steam_id, ban_status){
                    $.get("/API/UPDATE-BAN-STATUS/" + steam_id + "?ban_status=" + ban_status);
                },
                monitor_player(steam_id){
                    console.log("Monitoring player " + steam_id)
                    $.get('/API/MONITOR/' + steam_id);
                },
                toggle_competitor(steam_id){
                    $.get("/API/BECOME-COMPETITOR/" + steam_id)
                },
                fastest_is_competitor_only(is_enabled){
                    app.fastest_is_competitor_only = is_enabled;

                },
                secondsToHms(d) {
                    d = Number(d);
                    var h = Math.floor(d / 3600);
                    var m = Math.floor(d % 3600 / 60);
                    var s = Math.floor(d % 3600 % 60);

                    var hDisplay = h > 0 ? h + (h == 1 ? " hour, " : " hours, ") : "";
                    var mDisplay = m > 0 ? m + (m == 1 ? " minute, " : " minutes, ") : "";
                    var sDisplay = s > 0 ? s + (s == 1 ? " second" : " seconds") : "";
                    return hDisplay + mDisplay + sDisplay; 
                }
            }
        }
        )
        setInterval(function(){
            app.update_players();
        }, 200);
        setInterval(function(){
            app.updatePlayerNames();
        }, 200)
        setInterval(function(){
            app.update_trails();
        }, 200);
    </script>
    <style>
        table {
          border-collapse: collapse;
        }
        td {
          border:solid;
          border-width: 1px 1px;
          width:500px;
        }
    </style>
</html>